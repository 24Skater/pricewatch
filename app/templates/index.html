{% extends "base.html" %}
{% block content %}
<section class="card">
  <h1>Add a Tracker</h1>
  <form method="post" action="/trackers" class="grid">
    <input type="hidden" name="{{ csrf_field_name }}" value="{{ csrf_token(request) }}" />
    <label>
      Product URL
      <input type="url" name="url" placeholder="https://example.com/product" required maxlength="2000" />
    </label>
    <label>
      Name (optional)
      <input type="text" name="name" placeholder="Behringer X32" maxlength="500" />
    </label>
    <label>
      Alert method
      <select name="alert_method" required>
        <option value="email">Email</option>
        <option value="sms">SMS</option>
      </select>
    </label>
    <label>
      Contact (email or phone)
      <input type="text" name="contact" placeholder="you@example.com or +15551234567" required maxlength="255" />
    </label>
    <label>
      CSS selector (optional)
      <input type="text" name="selector" placeholder="#price, .price, [itemprop='price']" maxlength="1000" />
    </label>
    <label>
      Notification Profile (optional)
      <select name="profile_id">
        <option value="0">(use default env settings)</option>
        {% for p in profiles %}
          <option value="{{ p.id }}">{{ p.name }}</option>
        {% endfor %}
      </select>
    </label>
    <div class="actions">
      <button type="submit">Create tracker</button>
    </div>
  </form>
</section>

<section class="card">
  <h2>Existing Trackers</h2>
  {% if not trackers %}
    <p>No trackers yet — add one above.</p>
  {% else %}
    <table>
      <thead>
        <tr><th>Name</th><th>URL</th><th>Last Price</th><th>Profile</th><th>Actions</th></tr>
      </thead>
      <tbody>
      {% for t in trackers %}
        <tr>
          <td>{{ t.name or '—' }}</td>
          <td class="truncate"><a href="{{ t.url }}" target="_blank" rel="noopener">{{ t.url }}</a></td>
          <td>{{ '$' ~ ('%.2f' % t.last_price) if t.last_price is not none else '—' }}</td>
          <td>{{ t.profile.name if t.profile else 'default' }}</td>
          <td style="display:flex; gap:8px; flex-wrap:wrap;">
            <a class="btn" href="/tracker/{{ t.id }}">Open</a>
            <a class="btn" href="/tracker/{{ t.id }}/edit">Edit</a>
            <form method="post" action="/tracker/{{ t.id }}/delete" onsubmit="return confirm('Delete this tracker?')">
              <input type="hidden" name="{{ csrf_field_name }}" value="{{ csrf_token(request) }}" />
              <button class="btn danger" type="submit">Delete</button>
            </form>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  {% endif %}
</section>
{% endblock %}
